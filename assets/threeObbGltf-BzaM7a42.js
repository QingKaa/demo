import"./base-Bf5iE2VC.js";import{E as U}from"./button-BVAvt-av.js";import{u as k}from"./useHelper-BgGx8SJu.js";import{C as y,V as s,M as L,x as d,Y as P,_ as T,j as V,a3 as R,g as $,E as N,Z as q,$ as J,S as K,a0 as Y,A as Z,a4 as Q,c as X}from"./OrbitControls-sBDYM_KL.js";import{_ as ee,s as te,o as oe,c as ae,b as S,a as re,w as ne,m as se,p as le,i as ie}from"./index-Bh25nWXI.js";import{G as ce}from"./GLTFLoader-DEYGpcnJ.js";import{O as f}from"./OBB-Cmtq50qs.js";import"./isObject-BosxhSnN.js";import"./use-form-item-DLqAMvsS.js";import"./BufferGeometryUtils-CVRaOfRJ.js";const me=p=>(le("data-v-2d57381f"),p=p(),ie(),p),de={class:"page-container main-container w-full h-full relative"},pe=me(()=>S("div",{class:"webgl-target w-full h-full",id:"webglTarget"},null,-1)),ue={class:"absolute top-0 left-0"},H=1920728,be={__name:"threeObbGltf",setup(p){const{createGridHelper:j,createAxesHelper:z}=k(),A="/demo/";let n,u,l,x,r;const c=[];let h=Math.random(),C=new P;const b=new y;new s;const O=new URL("/demo/assets/gu2-MFKIJ2fa.glb",import.meta.url).href,g=new L({color:65280});function v(){n=new T,n.fog=new V(new y(1121588),50,100);const o=new R(16777215,2236962,1.5);o.position.set(1,1,1),n.add(o),new $().loadAsync(`${A}model/acoustical_shell_1k.jpg`).then(e=>{e.mapping=N,n.environment=e}),u=new q(75,window.innerWidth/window.innerHeight,.1,1e3),u.position.set(0,20,20),l=new J({logarithmicDepthBuffer:!0,antialias:!0,alpha:!0,precision:"mediump",premultipliedAlpha:!0}),l.shadowMap.enabled=!0,l.outputColorSpace=K,l.setSize(window.innerWidth,window.innerHeight),document.getElementById("webglTarget").appendChild(l.domElement),x=new Y(u,l.domElement),x.update();const a=new Z(16777215,1);n.add(a),n.add(j()),n.add(z())}let _=0,w=null;function I(){new ce().load(O,t=>{const a=t.scene;w=a.clone(),a.matrixWorldAutoUpdate=!0,n.add(a),a.traverse(e=>{if(e.isMesh){e.material.color.clone(b),e.material=g.clone(),e.material.color=b.clone(),e.material.name=`material_${_++}`,e.matrixAutoUpdate=!1;const i=new d(new s).setFromObject(e);e.userData.obb=new f,e.userData.obb.fromBox3(i),c.push({content:e,direction:new s(Math.random(),Math.random(),Math.random()).normalize()})}})})}function F(){const o=new s(1,1,1),t=new Q(o.x,o.y,o.z);t.userData.obb=new f,t.userData.obb.halfSize.copy(o).multiplyScalar(.5),r=new X(t,new L({color:H})),r.matrixAutoUpdate=!1,r.position.y=2,n.add(r),r.userData.obb=new f}te(()=>{v(),I(),F(),B()});function B(){h+=.05,requestAnimationFrame(B),r.position.x=Math.sin(h)*6,r.position.z=Math.cos(h)*6,r.updateMatrix(),r.updateMatrixWorld(),r.userData.obb.copy(r.geometry.userData.obb),r.userData.obb.applyMatrix4(r.matrixWorld),r.material.color.setHex(H);const o=C.getDelta();for(let t=0,a=c.length;t<a;t++){const e=c[t].content;e.rotation.x+=o*Math.PI*.2,e.rotation.y+=o*Math.PI*.1,e.updateMatrix(),e.updateMatrixWorld();const i=new d(new s).setFromObject(e);e.userData.obb.fromBox3(i),e.material.color.setHex(65280)}for(let t=0,a=m.length;t<a;t++){const e=m[t].content;e.rotation.x+=o*Math.PI*.2,e.rotation.y+=o*Math.PI*.1,e.updateMatrix(),e.updateMatrixWorld();const i=new d(new s).setFromObject(e);e.userData.obb.fromBox3(i),e.material.color.setHex(65280)}r.userData.obb;for(let t=0,a=c.length;t<a;t++){const{content:e,size:i}=c[t];new d(new s).setFromObject(e);const G=e.userData.obb;for(let M=0,W=m.length;M<W;M++){const{content:D}=m[M];G.intersectsOBB(D.userData.obb)===!0&&(D.material.color.setHex(16711680),e.material.color.setHex(16711680))}}x.update(),l.render(n,u)}const m=[];function E(){if(console.log("cachedModel",w),!w)return;const o=w.clone();n.add(o),o.traverse(t=>{if(t.isMesh){t.material.color.clone(b),t.material=g.clone(),t.material.color=b.clone(),t.material.name=`material_${_++}`,t.matrixAutoUpdate=!1;const a=new d(new s).setFromObject(t);t.userData.obb=new f,t.userData.obb.fromBox3(a),m.push({content:t,direction:new s(Math.random(),Math.random(),Math.random()).normalize()})}}),o.position.z=5}return(o,t)=>{const a=U;return oe(),ae("div",de,[pe,S("div",ue,[re(a,{type:"primary",size:"small",onClick:E},{default:ne(()=>[se("加载更多")]),_:1})])])}}},Le=ee(be,[["__scopeId","data-v-2d57381f"]]);export{Le as default};
