import"./base-CoA0Fdnj.js";import{E as I}from"./button-xph9Lk08.js";import{u as U}from"./useHelper-BgGx8SJu.js";import{C as D,V as s,M as y,x as d,Y as k,_ as P,j as T,a3 as V,g as R,E as $,Z as N,$ as q,S as J,a0 as K,A as Y,a4 as Z,c as Q}from"./OrbitControls-sBDYM_KL.js";import{_ as X,p as ee,o as te,c as oe,b as L,a as ae,w as re,l as ne}from"./index-BdHghL4a.js";import{G as se}from"./GLTFLoader-DEYGpcnJ.js";import{O as w}from"./OBB-Cmtq50qs.js";import"./isObject-BosxhSnN.js";import"./use-form-item-BKQAsjkg.js";import"./BufferGeometryUtils-CVRaOfRJ.js";const le={class:"page-container main-container w-full h-full relative"},ie={class:"absolute top-0 left-0"},H=1920728,ce={__name:"threeObbGltf",setup(me){const{createGridHelper:j,createAxesHelper:z}=U(),A="/demo/";let n,u,l,f,r;const c=[];let x=Math.random(),C=new k;const p=new D;new s;const O=new URL("/demo/assets/gu2-MFKIJ2fa.glb",import.meta.url).href,M=new y({color:65280});function v(){n=new P,n.fog=new T(new D(1121588),50,100);const o=new V(16777215,2236962,1.5);o.position.set(1,1,1),n.add(o),new R().loadAsync(`${A}model/acoustical_shell_1k.jpg`).then(t=>{t.mapping=$,n.environment=t}),u=new N(75,window.innerWidth/window.innerHeight,.1,1e3),u.position.set(0,20,20),l=new q({logarithmicDepthBuffer:!0,antialias:!0,alpha:!0,precision:"mediump",premultipliedAlpha:!0}),l.shadowMap.enabled=!0,l.outputColorSpace=J,l.setSize(window.innerWidth,window.innerHeight),document.getElementById("webglTarget").appendChild(l.domElement),f=new K(u,l.domElement),f.update();const a=new Y(16777215,1);n.add(a),n.add(j()),n.add(z())}let g=0,b=null;function F(){new se().load(O,e=>{const a=e.scene;b=a.clone(),a.matrixWorldAutoUpdate=!0,n.add(a),a.traverse(t=>{if(t.isMesh){t.material.color.clone(p),t.material=M.clone(),t.material.color=p.clone(),t.material.name=`material_${g++}`,t.matrixAutoUpdate=!1;const i=new d(new s).setFromObject(t);t.userData.obb=new w,t.userData.obb.fromBox3(i),c.push({content:t,direction:new s(Math.random(),Math.random(),Math.random()).normalize()})}})})}function S(){const o=new s(1,1,1),e=new Z(o.x,o.y,o.z);e.userData.obb=new w,e.userData.obb.halfSize.copy(o).multiplyScalar(.5),r=new Q(e,new y({color:H})),r.matrixAutoUpdate=!1,r.position.y=2,n.add(r),r.userData.obb=new w}ee(()=>{v(),F(),S(),_()});function _(){x+=.05,requestAnimationFrame(_),r.position.x=Math.sin(x)*6,r.position.z=Math.cos(x)*6,r.updateMatrix(),r.updateMatrixWorld(),r.userData.obb.copy(r.geometry.userData.obb),r.userData.obb.applyMatrix4(r.matrixWorld),r.material.color.setHex(H);const o=C.getDelta();for(let e=0,a=c.length;e<a;e++){const t=c[e].content;t.rotation.x+=o*Math.PI*.2,t.rotation.y+=o*Math.PI*.1,t.updateMatrix(),t.updateMatrixWorld();const i=new d(new s).setFromObject(t);t.userData.obb.fromBox3(i),t.material.color.setHex(65280)}for(let e=0,a=m.length;e<a;e++){const t=m[e].content;t.rotation.x+=o*Math.PI*.2,t.rotation.y+=o*Math.PI*.1,t.updateMatrix(),t.updateMatrixWorld();const i=new d(new s).setFromObject(t);t.userData.obb.fromBox3(i),t.material.color.setHex(65280)}r.userData.obb;for(let e=0,a=c.length;e<a;e++){const{content:t,size:i}=c[e];new d(new s).setFromObject(t);const G=t.userData.obb;for(let h=0,W=m.length;h<W;h++){const{content:B}=m[h];G.intersectsOBB(B.userData.obb)===!0&&(B.material.color.setHex(16711680),t.material.color.setHex(16711680))}}f.update(),l.render(n,u)}const m=[];function E(){if(console.log("cachedModel",b),!b)return;const o=b.clone();n.add(o),o.traverse(e=>{if(e.isMesh){e.material.color.clone(p),e.material=M.clone(),e.material.color=p.clone(),e.material.name=`material_${g++}`,e.matrixAutoUpdate=!1;const a=new d(new s).setFromObject(e);e.userData.obb=new w,e.userData.obb.fromBox3(a),m.push({content:e,direction:new s(Math.random(),Math.random(),Math.random()).normalize()})}}),o.position.z=5}return(o,e)=>{const a=I;return te(),oe("div",le,[e[1]||(e[1]=L("div",{class:"webgl-target w-full h-full",id:"webglTarget"},null,-1)),L("div",ie,[ae(a,{type:"primary",size:"small",onClick:E},{default:re(()=>e[0]||(e[0]=[ne("加载更多")])),_:1})])])}}},_e=X(ce,[["__scopeId","data-v-2d57381f"]]);export{_e as default};
